<div class="register-container">
  <div class="register-card">
    <h1>Crear Cuenta</h1>
    <p class="subtitle">√önete a {{ tenantName() }}</p>

    @if (!hasTenant()) {
    <div class="alert alert-error">
      No hay un comercio activo. El registro de clientes solo est√° disponible cuando accedes a trav√©s de un comercio espec√≠fico.
    </div>
    }

    @if (errorMessage()) {
    <div class="alert alert-error">
      {{ errorMessage() }}
    </div>
    }

    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">
      <div class="form-row">
        <div class="form-group">
          <label for="firstName">Nombre</label>
          <input
            type="text"
            id="firstName"
            formControlName="firstName"
            placeholder="Juan"
            [class.error]="getFieldError('firstName')"
          />
          @if (getFieldError('firstName')) {
          <span class="error-message">{{ getFieldError('firstName') }}</span>
          }
        </div>

        <div class="form-group">
          <label for="lastName">Apellido</label>
          <input
            type="text"
            id="lastName"
            formControlName="lastName"
            placeholder="P√©rez"
            [class.error]="getFieldError('lastName')"
          />
          @if (getFieldError('lastName')) {
          <span class="error-message">{{ getFieldError('lastName') }}</span>
          }
        </div>
      </div>

      <div class="form-group">
        <label for="email">Email</label>
        <input
          type="email"
          id="email"
          formControlName="email"
          placeholder="tu@email.com"
          [class.error]="getFieldError('email')"
        />
        @if (getFieldError('email')) {
        <span class="error-message">{{ getFieldError('email') }}</span>
        }
      </div>

      <div class="form-group">
        <label for="phoneNumber">Tel√©fono (opcional)</label>
        <input
          type="tel"
          id="phoneNumber"
          formControlName="phoneNumber"
          placeholder="+34 600 000 000"
        />
      </div>

      <div class="form-group">
        <label for="password">Contrase√±a</label>
        <div class="password-input">
          <input
            [type]="showPassword() ? 'text' : 'password'"
            id="password"
            formControlName="password"
            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
            [class.error]="getFieldError('password')"
          />
          <button
            type="button"
            class="toggle-password"
            (click)="togglePasswordVisibility()"
            aria-label="Mostrar contrase√±a"
          >
            {{ showPassword() ? 'üôà' : 'üëÅÔ∏è' }}
          </button>
        </div>
        @if (getFieldError('password')) {
        <span class="error-message">{{ getFieldError('password') }}</span>
        }
      </div>

      <div class="form-group">
        <label for="confirmPassword">Confirmar Contrase√±a</label>
        <div class="password-input">
          <input
            [type]="showConfirmPassword() ? 'text' : 'password'"
            id="confirmPassword"
            formControlName="confirmPassword"
            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
            [class.error]="
              getFieldError('confirmPassword') || !passwordsMatch()
            "
          />
          <button
            type="button"
            class="toggle-password"
            (click)="toggleConfirmPasswordVisibility()"
            aria-label="Mostrar contrase√±a"
          >
            {{ showConfirmPassword() ? 'üôà' : 'üëÅÔ∏è' }}
          </button>
        </div>
        @if (getFieldError('confirmPassword')) {
        <span class="error-message">{{
          getFieldError('confirmPassword')
        }}</span>
        } @if (!passwordsMatch() &&
        registerForm.get('confirmPassword')?.touched) {
        <span class="error-message">Las contrase√±as no coinciden</span>
        }
      </div>

      <div class="form-group checkbox-group">
        <label>
          <input type="checkbox" formControlName="acceptTerms" />
          <span>
            Acepto los
            <a href="/terms" target="_blank">t√©rminos y condiciones</a>
          </span>
        </label>
      </div>
      @if (getFieldError('acceptTerms')) {
      <span class="error-message">{{ getFieldError('acceptTerms') }}</span>
      }

      <button
        type="submit"
        class="btn-primary"
        [disabled]="!hasTenant() || isLoading() || registerForm.invalid || !passwordsMatch()"
      >
        @if (isLoading()) {
        <span class="spinner"></span>
        Creando cuenta... } @else { Crear Cuenta }
      </button>
    </form>

    <div class="footer-links">
      <p>
        ¬øYa tienes cuenta?
        <a routerLink="/account/login">Inicia sesi√≥n aqu√≠</a>
      </p>
    </div>
  </div>
</div>
