<div class="profile-container">
  <div class="profile-card">
    <h1>Mi Perfil</h1>

    @if (errorMessage()) {
    <div class="alert alert-error">
      {{ errorMessage() }}
    </div>
    } @if (successMessage()) {
    <div class="alert alert-success">
      {{ successMessage() }}
    </div>
    } @if (user()) {
    <div class="profile-section">
      <div class="section-header">
        <h2>Información Personal</h2>
        <button type="button" class="btn-secondary" (click)="toggleEditMode()">
          {{ isEditMode() ? 'Cancelar' : 'Editar' }}
        </button>
      </div>

      <form [formGroup]="profileForm" (ngSubmit)="saveProfile()">
        <div class="form-row">
          <div class="form-group">
            <label for="firstName">Nombre</label>
            <input
              type="text"
              id="firstName"
              formControlName="firstName"
              [readonly]="!isEditMode()"
            />
          </div>

          <div class="form-group">
            <label for="lastName">Apellido</label>
            <input
              type="text"
              id="lastName"
              formControlName="lastName"
              [readonly]="!isEditMode()"
            />
          </div>
        </div>

        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" formControlName="email" readonly />
          <small>El email no se puede cambiar</small>
        </div>

        <div class="form-group">
          <label for="phoneNumber">Teléfono</label>
          <input
            type="tel"
            id="phoneNumber"
            formControlName="phoneNumber"
            [readonly]="!isEditMode()"
          />
        </div>

        @if (isEditMode()) {
        <button
          type="submit"
          class="btn-primary"
          [disabled]="isLoading() || profileForm.invalid"
        >
          @if (isLoading()) {
          <span class="spinner"></span>
          Guardando... } @else { Guardar Cambios }
        </button>
        }
      </form>
    </div>

    <div class="profile-section">
      <h2>Cambiar Contraseña</h2>

      <form [formGroup]="passwordForm" (ngSubmit)="changePassword()">
        <div class="form-group">
          <label for="currentPassword">Contraseña Actual</label>
          <input
            type="password"
            id="currentPassword"
            formControlName="currentPassword"
            placeholder="••••••••"
          />
        </div>

        <div class="form-group">
          <label for="newPassword">Nueva Contraseña</label>
          <input
            type="password"
            id="newPassword"
            formControlName="newPassword"
            placeholder="••••••••"
          />
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirmar Nueva Contraseña</label>
          <input
            type="password"
            id="confirmPassword"
            formControlName="confirmPassword"
            placeholder="••••••••"
          />
        </div>

        <button
          type="submit"
          class="btn-primary"
          [disabled]="isLoading() || passwordForm.invalid"
        >
          @if (isLoading()) {
          <span class="spinner"></span>
          Cambiando... } @else { Cambiar Contraseña }
        </button>
      </form>
    </div>

    <div class="profile-section">
      <h2>Información de Cuenta</h2>
      <div class="info-grid">
        <div class="info-item">
          <span class="info-label">Rol:</span>
          <span class="info-value">{{ user()!.role }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Fecha de registro:</span>
          <span class="info-value">{{
            user()!.createdAt | date : 'medium'
          }}</span>
        </div>
        @if (user()!.lastLogin) {
        <div class="info-item">
          <span class="info-label">Último acceso:</span>
          <span class="info-value">{{
            user()!.lastLogin | date : 'medium'
          }}</span>
        </div>
        }
      </div>
    </div>

    <div class="profile-section">
      <button type="button" class="btn-danger" (click)="logout()">
        Cerrar Sesión
      </button>
    </div>
    }
  </div>
</div>
