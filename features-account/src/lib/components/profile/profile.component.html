<div class="profile-container">
  <div class="profile-card">
    <h1>Mi Perfil</h1>

    @if (errorMessage()) {
    <div class="alert alert-error">
      {{ errorMessage() }}
    </div>
    } @if (successMessage()) {
    <div class="alert alert-success">
      {{ successMessage() }}
    </div>
    }

    @if (user()) {
    <!-- Tabs Navigation -->
    <div class="tabs-navigation">
      <button
        type="button"
        class="tab-button"
        [class.active]="activeTab() === 'profile'"
        (click)="switchTab('profile')"
      >
        Información Personal
      </button>
      <button
        type="button"
        class="tab-button"
        [class.active]="activeTab() === 'password'"
        (click)="switchTab('password')"
      >
        Cambiar Contraseña
      </button>
    </div>

    <!-- Tab Content: Información Personal -->
    @if (activeTab() === 'profile') {
    <div class="tab-content">
      <div class="section-header">
        <h2>Información Personal</h2>
        <button type="button" class="btn-secondary" (click)="toggleEditMode()">
          {{ isEditMode() ? 'Cancelar' : 'Editar' }}
        </button>
      </div>

      <form [formGroup]="profileForm" (ngSubmit)="saveProfile()">
        <div class="form-row">
          <div class="form-group">
            <label for="firstName">Nombre</label>
            <input
              type="text"
              id="firstName"
              formControlName="firstName"
              [readonly]="!isEditMode()"
            />
          </div>

          <div class="form-group">
            <label for="lastName">Apellido</label>
            <input
              type="text"
              id="lastName"
              formControlName="lastName"
              [readonly]="!isEditMode()"
            />
          </div>
        </div>

        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" formControlName="email" readonly />
          <small>El email no se puede cambiar</small>
        </div>

        <div class="form-group">
          <label for="phoneNumber">Teléfono</label>
          <input
            type="tel"
            id="phoneNumber"
            formControlName="phoneNumber"
            placeholder="+57 300 123 4567"
            [readonly]="!isEditMode()"
          />
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="documentType">Tipo de Documento</label>
            <select
              id="documentType"
              formControlName="documentType"
              [disabled]="!isEditMode()"
            >
              <option value="">Seleccione...</option>
              <option value="CC">Cédula de Ciudadanía</option>
              <option value="CE">Cédula de Extranjería</option>
              <option value="TI">Tarjeta de Identidad</option>
              <option value="PA">Pasaporte</option>
            </select>
          </div>

          <div class="form-group">
            <label for="documentNumber">Número de Documento</label>
            <input
              type="text"
              id="documentNumber"
              formControlName="documentNumber"
              [readonly]="!isEditMode()"
            />
          </div>
        </div>

        <div class="form-group">
          <label for="birthDate">Fecha de Nacimiento</label>
          <input
            type="date"
            id="birthDate"
            formControlName="birthDate"
            [readonly]="!isEditMode()"
          />
        </div>

        <div class="form-group">
          <label for="address">Dirección</label>
          <input
            type="text"
            id="address"
            formControlName="address"
            placeholder="Calle 123 #45-67"
            [readonly]="!isEditMode()"
          />
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="city">Ciudad</label>
            <input
              type="text"
              id="city"
              formControlName="city"
              [readonly]="!isEditMode()"
            />
          </div>

          <div class="form-group">
            <label for="country">País</label>
            <input
              type="text"
              id="country"
              formControlName="country"
              [readonly]="!isEditMode()"
            />
          </div>
        </div>

        @if (isEditMode()) {
        <button
          type="submit"
          class="btn-primary"
          [disabled]="isLoading() || profileForm.invalid"
        >
          @if (isLoading()) {
          <span class="spinner"></span>
          Guardando... } @else { Guardar Cambios }
        </button>
        }
      </form>
    </div>
    }

    <!-- Tab Content: Cambiar Contraseña -->
    @if (activeTab() === 'password') {
    <div class="tab-content">
      <h2>Cambiar Contraseña</h2>

      <form [formGroup]="passwordForm" (ngSubmit)="changePassword()">
        <div class="form-group">
          <label for="currentPassword">Contraseña Actual</label>
          <input
            type="password"
            id="currentPassword"
            formControlName="currentPassword"
            placeholder="••••••••"
          />
        </div>

        <div class="form-group">
          <label for="newPassword">Nueva Contraseña</label>
          <input
            type="password"
            id="newPassword"
            formControlName="newPassword"
            placeholder="••••••••"
          />
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirmar Nueva Contraseña</label>
          <input
            type="password"
            id="confirmPassword"
            formControlName="confirmPassword"
            placeholder="••••••••"
          />
        </div>

        <button
          type="submit"
          class="btn-primary"
          [disabled]="isLoading() || passwordForm.invalid"
        >
          @if (isLoading()) {
          <span class="spinner"></span>
          Cambiando... } @else { Cambiar Contraseña }
        </button>
      </form>
    </div>
    }

    <!-- Logout Button -->
    <div class="logout-section">
      <button type="button" class="btn-danger" (click)="logout()">
        Cerrar Sesión
      </button>
    </div>
    }
  </div>
</div>
