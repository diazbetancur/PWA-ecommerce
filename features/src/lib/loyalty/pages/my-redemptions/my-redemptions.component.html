<div class="my-redemptions-page">
  <!-- Header -->
  <div class="page-header">
    <h1>üéüÔ∏è Mis Canjes</h1>
    <p>Historial de premios canjeados</p>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div class="filter-group">
      <label for="statusFilter">Estado:</label>
      <select
        id="statusFilter"
        [(ngModel)]="selectedStatus"
        (change)="onFilterChange()"
        class="form-select"
      >
        <option value="">Todos</option>
        <option value="PENDING">Pendiente</option>
        <option value="APPROVED">Aprobado</option>
        <option value="DELIVERED">Entregado</option>
        <option value="CANCELLED">Cancelado</option>
        <option value="EXPIRED">Expirado</option>
      </select>
    </div>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
  <div class="loading-container">
    <div class="spinner"></div>
    <p>Cargando canjes...</p>
  </div>
  }

  <!-- Error State -->
  @if (error()) {
  <div class="alert alert-danger"><strong>Error:</strong> {{ error() }}</div>
  }

  <!-- Redemptions List -->
  @if (!isLoading() && redemptions().length > 0) {
  <div class="redemptions-list">
    @for (redemption of redemptions(); track redemption.id) {
    <div class="redemption-card">
      <!-- Status Badge -->
      <div class="card-header">
        <div
          class="status-badge"
          [attr.data-status]="getStatusColor(redemption.status)"
        >
          {{ getStatusLabel(redemption.status) }}
        </div>
        <div class="redemption-date">
          {{ formatDate(redemption.redeemedAt) }}
        </div>
      </div>

      <!-- Content -->
      <div class="card-content">
        <div class="reward-info">
          <h3 class="reward-name">{{ redemption.rewardName }}</h3>
          <div class="points-spent">
            <span class="icon">üíé</span>
            <span class="points">{{
              redemption.pointsSpent | number : '1.0-0'
            }}</span>
            <span class="label">puntos gastados</span>
          </div>
        </div>

        <!-- Coupon Code (if exists) -->
        @if (redemption.couponCode) {
        <div class="coupon-section">
          <div class="coupon-label">C√≥digo de Cup√≥n:</div>
          <div class="coupon-code">
            <span class="code">{{ redemption.couponCode }}</span>
            <button
              class="copy-btn"
              (click)="copyCouponCode(redemption.couponCode!)"
              title="Copiar c√≥digo"
            >
              üìã
            </button>
          </div>
        </div>
        }

        <!-- Timeline -->
        <div class="timeline">
          <div class="timeline-item completed">
            <div class="timeline-icon">‚úì</div>
            <div class="timeline-content">
              <div class="timeline-label">Canjeado</div>
              <div class="timeline-date">
                {{ formatDateTime(redemption.redeemedAt) }}
              </div>
            </div>
          </div>

          @if (redemption.approvedAt) {
          <div class="timeline-item completed">
            <div class="timeline-icon">‚úì</div>
            <div class="timeline-content">
              <div class="timeline-label">Aprobado</div>
              <div class="timeline-date">
                {{ formatDateTime(redemption.approvedAt) }}
              </div>
            </div>
          </div>
          } @if (redemption.deliveredAt) {
          <div class="timeline-item completed">
            <div class="timeline-icon">‚úì</div>
            <div class="timeline-content">
              <div class="timeline-label">Entregado</div>
              <div class="timeline-date">
                {{ formatDateTime(redemption.deliveredAt) }}
              </div>
            </div>
          </div>
          }
        </div>

        <!-- Expiration Info -->
        @if (redemption.expiresAt && redemption.status === 'APPROVED') {
        <div class="expiration-warning">
          ‚è∞ Vence el {{ formatDate(redemption.expiresAt) }}
        </div>
        }

        <!-- Admin Notes -->
        @if (redemption.adminNotes) {
        <div class="admin-notes">
          <strong>Nota:</strong> {{ redemption.adminNotes }}
        </div>
        }
      </div>
    </div>
    }
  </div>

  <!-- Pagination -->
  @if (totalPages() > 1) {
  <div class="pagination">
    <button
      class="page-btn"
      [disabled]="currentPage() === 1"
      (click)="goToPage(currentPage() - 1)"
    >
      ‚Üê Anterior
    </button>

    <span class="page-info">
      P√°gina {{ currentPage() }} de {{ totalPages() }}
    </span>

    <button
      class="page-btn"
      [disabled]="currentPage() === totalPages()"
      (click)="goToPage(currentPage() + 1)"
    >
      Siguiente ‚Üí
    </button>
  </div>
  } }

  <!-- Empty State -->
  @if (!isLoading() && redemptions().length === 0) {
  <div class="empty-state">
    <div class="empty-icon">üéüÔ∏è</div>
    <h3>No tienes canjes a√∫n</h3>
    <p>Visita el cat√°logo de premios para canjear tus puntos</p>
    <button class="cta-btn" (click)="navigateToCatalog()">
      Ver Cat√°logo de Premios
    </button>
  </div>
  }
</div>
