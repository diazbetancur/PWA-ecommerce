<section class="categories" *ngIf="categories() as cats">
  <button class="pill" [class.active]="!category()" (click)="setCategory(null)">
    Todas
  </button>
  <button
    class="pill"
    *ngFor="let c of cats"
    [class.active]="category() === c.slug"
    (click)="setCategory(c.slug)"
  >
    {{ c.name }}
  </button>
  <div *ngIf="!cats?.length" class="empty">Sin categorías</div>
  <div *ngIf="categories() === null" class="skeleton skeleton-row"></div>
</section>

<section class="toolbar">
  <div class="count" aria-live="polite">{{ total() }} productos</div>
  <label class="sort">
    Ordenar:
    <select [value]="sort()" (change)="setSort($any($event.target).value)">
      <option value="newest">Novedades</option>
      <option value="priceAsc">Precio: menor a mayor</option>
      <option value="priceDesc">Precio: mayor a menor</option>
      <option value="nameAsc">Nombre: A-Z</option>
      <option value="nameDesc">Nombre: Z-A</option>
    </select>
  </label>
</section>

<section class="grid" *ngIf="!loading(); else loadingTpl">
  <article class="card" *ngFor="let p of products(); trackBy: trackById">
    <a [routerLink]="['/p', p.id]" class="image">
      <img
        [ngSrc]="p.imageUrl || p.images?.[0] || '/icons/icon-192x192.png'"
        width="320"
        height="320"
        loading="lazy"
        decoding="async"
        alt="{{ p.name }}"
      />
    </a>
    <div class="info">
      <h3 class="name">{{ p.name }}</h3>
      <div class="price">{{ p.price | currency }}</div>
      <button class="add" type="button">Agregar</button>
    </div>
  </article>
  <div *ngIf="!products()?.length && !error()" class="empty">
    Sin resultados
  </div>
  <div *ngIf="error()" class="error">
    {{ error() }}
    <button type="button" (click)="load()">Reintentar</button>
  </div>
</section>

<ng-template #loadingTpl>
  <div class="grid">
    <div class="card" *ngFor="let i of [1,2,3,4,5,6,7,8,9,10,11,12]">
      <div class="skeleton skeleton-img"></div>
      <div class="skeleton skeleton-text"></div>
      <div class="skeleton skeleton-text small"></div>
    </div>
  </div>
</ng-template>

<nav class="pagination" *ngIf="total() > pageSize()">
  <button type="button" [disabled]="page() <= 1" (click)="setPage(page() - 1)">
    « Anterior
  </button>
  <span>Página {{ page() }}</span>
  <button
    type="button"
    [disabled]="products()?.length! < pageSize()"
    (click)="setPage(page() + 1)"
  >
    Siguiente »
  </button>
</nav>
