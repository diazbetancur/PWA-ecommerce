<div class="category-form-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>
        <div class="header-content">
          <div class="title-section">
            <app-button
              variant="ghost"
              icon="arrow_back"
              size="sm"
              (clicked)="cancel()"
            >
            </app-button>
            <mat-icon>{{ isEditMode() ? 'edit' : 'add' }}</mat-icon>
            <h1>{{ pageTitle() }}</h1>
          </div>
        </div>
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      @if (loading() && isEditMode()) {
      <div class="loading-container">
        <mat-spinner diameter="50"></mat-spinner>
        <p>Cargando categoría...</p>
      </div>
      } @else {
      <form [formGroup]="form" (ngSubmit)="onSubmit()" class="category-form">
        <!-- Nombre -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Nombre</mat-label>
          <input
            matInput
            formControlName="name"
            placeholder="Ej: Electrónica"
            required
          />
          @if (form.get('name')?.invalid && form.get('name')?.touched) {
          <mat-error>{{ getErrorMessage('name') }}</mat-error>
          }
          <mat-hint>El slug se generará automáticamente</mat-hint>
        </mat-form-field>

        <!-- Descripción -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Descripción</mat-label>
          <textarea
            matInput
            formControlName="description"
            placeholder="Descripción de la categoría"
            rows="4"
            maxlength="500"
          ></textarea>
          @if (form.get('description')?.invalid &&
          form.get('description')?.touched) {
          <mat-error>{{ getErrorMessage('description') }}</mat-error>
          }
          <mat-hint align="end">
            {{ form.get('description')?.value?.length || 0 }} / 500
          </mat-hint>
        </mat-form-field>

        <!-- URL de Imagen -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>URL de Imagen</mat-label>
          <input
            matInput
            formControlName="imageUrl"
            placeholder="https://ejemplo.com/imagen.jpg"
            type="url"
          />
          <mat-hint>URL completa de la imagen de la categoría</mat-hint>
        </mat-form-field>

        <!-- Preview de imagen -->
        @if (form.get('imageUrl')?.value) {
        <div class="image-preview">
          <p class="preview-label">Vista previa:</p>
          <img
            [src]="form.get('imageUrl')?.value"
            alt="Preview"
            (error)="$event.target.src = ''"
            class="preview-image"
          />
        </div>
        }

        <!-- Estado Activo -->
        <div class="checkbox-field">
          <mat-checkbox formControlName="isActive">
            Categoría activa
          </mat-checkbox>
          <p class="checkbox-hint">
            Las categorías inactivas no se mostrarán en el catálogo público
          </p>
        </div>

        <!-- Info adicional en modo edición -->
        @if (isEditMode() && category()) {
        <div class="info-section">
          <h3>Información Adicional</h3>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">Slug:</span>
              <code>{{ category()!.slug }}</code>
            </div>
            <div class="info-item">
              <span class="info-label">Productos:</span>
              <span>{{ category()!.productCount }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Creada:</span>
              <span>{{ category()!.createdAt | date : 'short' }}</span>
            </div>
            @if (category()!.updatedAt) {
            <div class="info-item">
              <span class="info-label">Actualizada:</span>
              <span>{{ category()!.updatedAt | date : 'short' }}</span>
            </div>
            }
          </div>
        </div>
        }

        <!-- Botones de acción -->
        <div class="form-actions">
          <app-button
            type="button"
            variant="ghost"
            (clicked)="cancel()"
            [disabled]="loading()"
          >
            Cancelar
          </app-button>

          <app-button
            type="submit"
            variant="primary"
            [disabled]="form.invalid || loading()"
            [loading]="loading()"
            icon="save"
          >
            {{ submitButtonText() }}
          </app-button>
        </div>
      </form>
      }
    </mat-card-content>
  </mat-card>
</div>
