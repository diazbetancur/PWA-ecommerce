<div class="program-config-page">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <button class="back-btn" (click)="goBack()"><span>‚Üê</span> Volver</button>
      <div>
        <h1>‚öôÔ∏è Configuraci√≥n del Programa</h1>
        <p class="subtitle">
          Gestiona el factor de conversi√≥n y reglas del programa de lealtad
        </p>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
  <div class="loading-container">
    <div class="spinner"></div>
    <p>Cargando configuraci√≥n...</p>
  </div>
  }

  <!-- Form -->
  @if (!isLoading() && configForm) {
  <form [formGroup]="configForm" (ngSubmit)="onSubmit()" class="config-form">
    <!-- Estado del Programa -->
    <div class="form-section">
      <h2>üìä Estado del Programa</h2>
      <div class="form-group">
        <label class="toggle-label">
          <input
            type="checkbox"
            formControlName="isEnabled"
            class="toggle-checkbox"
          />
          <span class="toggle-slider"></span>
          <span class="toggle-text">Programa Activo</span>
        </label>
        <p class="help-text">
          Cuando est√° desactivado, los usuarios no pueden ganar ni canjear
          puntos
        </p>
      </div>
    </div>

    <!-- Factor de Conversi√≥n -->
    <div class="form-section">
      <h2>üí∞ Factor de Conversi√≥n</h2>
      <div class="conversion-info">
        <p class="info-text">
          Define cu√°ntos puntos se otorgan por cada unidad monetaria gastada
        </p>
      </div>

      <div class="form-row">
        <div class="form-group flex-1">
          <label for="currencyAmount"> Monto en Moneda ($) </label>
          <input
            type="number"
            id="currencyAmount"
            class="form-control"
            [value]="currencyAmount()"
            (input)="onCurrencyAmountChange($event)"
            min="1"
            step="100"
          />
          <p class="help-text">Ej: 100 (cien pesos/d√≥lares)</p>
        </div>

        <div class="equals-sign">=</div>

        <div class="form-group flex-1">
          <label for="conversionRate">Factor de Conversi√≥n</label>
          <input
            type="number"
            id="conversionRate"
            class="form-control"
            formControlName="conversionRate"
            min="0.000001"
            step="0.01"
            readonly
          />
          <p class="help-text">Calculado autom√°ticamente</p>
        </div>
      </div>

      <div class="conversion-examples">
        <h4>üìã Ejemplos de conversi√≥n:</h4>
        <div class="current-example">
          <strong>Tu configuraci√≥n actual:</strong> Una compra de $500 otorgar√°
          <strong class="highlight">
            {{
              500 * (configForm.get('conversionRate')?.value || 0)
                | number : '1.0-2'
            }}
          </strong>
          puntos
        </div>
      </div>
    </div>

    <!-- Monto M√≠nimo de Compra -->
    <div class="form-section">
      <h2>üõí Monto M√≠nimo de Compra</h2>
      <div class="form-group">
        <label for="minPurchaseForPoints">Monto M√≠nimo (opcional)</label>
        <input
          type="number"
          id="minPurchaseForPoints"
          class="form-control"
          formControlName="minPurchaseForPoints"
          min="0"
          step="10"
        />
        <p class="help-text">
          Monto m√≠nimo de compra para obtener puntos. Deja en 0 o vac√≠o para sin
          m√≠nimo.
        </p>
      </div>
    </div>

    <!-- Expiraci√≥n de Puntos -->
    <div class="form-section">
      <h2>‚è∞ Expiraci√≥n de Puntos</h2>
      <div class="form-group">
        <label for="pointsExpirationDays">D√≠as de Expiraci√≥n</label>
        <input
          type="number"
          id="pointsExpirationDays"
          class="form-control"
          formControlName="pointsExpirationDays"
          min="0"
          step="30"
        />
        <p class="help-text">
          N√∫mero de d√≠as hasta que expiran los puntos. Deja en 0 o vac√≠o para
          que no expiren.
        </p>
      </div>
    </div>

    <!-- Actions -->
    <div class="form-actions">
      <button type="button" class="btn btn-secondary" (click)="goBack()">
        Cancelar
      </button>
      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="configForm.invalid || isSaving()"
      >
        @if (isSaving()) {
        <span class="spinner-sm"></span>
        } Guardar Configuraci√≥n
      </button>
    </div>
  </form>
  }
</div>
