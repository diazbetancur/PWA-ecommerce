<div class="redemptions-list-page">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>ğŸŸï¸ GestiÃ³n de Canjes</h1>
      <p>Administra todos los canjes de premios del programa</p>
    </div>
    @if (pendingCount() > 0) {
    <div class="pending-alert">
      <span class="icon">â³</span>
      <span
        ><strong>{{ pendingCount() }}</strong> canjes pendientes</span
      >
    </div>
    }
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div class="filter-group">
      <label for="statusFilter">Estado:</label>
      <select
        id="statusFilter"
        [(ngModel)]="selectedStatus"
        (change)="onFilterChange()"
        class="form-select"
      >
        <option value="">Todos</option>
        <option value="PENDING">Pendiente</option>
        <option value="APPROVED">Aprobado</option>
        <option value="DELIVERED">Entregado</option>
        <option value="CANCELLED">Cancelado</option>
        <option value="EXPIRED">Expirado</option>
      </select>
    </div>

    <div class="filter-group">
      <label for="userSearch">Usuario:</label>
      <input
        type="text"
        id="userSearch"
        [(ngModel)]="userSearch"
        (input)="onFilterChange()"
        placeholder="Buscar por email o nombre..."
        class="form-input"
      />
    </div>

    <div class="filter-group">
      <label for="fromDate">Desde:</label>
      <input
        type="date"
        id="fromDate"
        [(ngModel)]="fromDate"
        (change)="onFilterChange()"
        class="form-input"
      />
    </div>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
  <div class="loading-container">
    <div class="spinner"></div>
    <p>Cargando canjes...</p>
  </div>
  }

  <!-- Error State -->
  @if (error()) {
  <div class="alert alert-danger"><strong>Error:</strong> {{ error() }}</div>
  }

  <!-- Redemptions Table -->
  @if (!isLoading() && redemptions().length > 0) {
  <div class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th>Usuario</th>
          <th>Premio</th>
          <th>Puntos</th>
          <th>Fecha</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        @for (redemption of redemptions(); track redemption.id) {
        <tr>
          <td class="user-cell">
            <div class="user-info">
              <strong>{{ redemption.userName || 'Usuario' }}</strong>
              <span class="user-email">{{ redemption.userEmail }}</span>
            </div>
          </td>
          <td class="reward-cell">
            <div class="reward-info">
              <strong>{{ redemption.rewardName }}</strong>
              @if (redemption.couponCode) {
              <span class="coupon-code">
                <span class="icon">ğŸ«</span>
                {{ redemption.couponCode }}
              </span>
              }
            </div>
          </td>
          <td class="points-cell">
            <span class="icon">ğŸ’</span>
            {{ redemption.pointsSpent | number }}
          </td>
          <td class="date-cell">
            {{ formatDate(redemption.redeemedAt) }}
          </td>
          <td>
            <span
              class="status-badge"
              [attr.data-status]="getStatusColor(redemption.status)"
            >
              {{ getStatusLabel(redemption.status) }}
            </span>
          </td>
          <td class="actions-cell">
            @if (redemption.status === 'PENDING') {
            <button
              class="btn-sm success"
              (click)="approveRedemption(redemption)"
              title="Aprobar"
            >
              âœ“ Aprobar
            </button>
            <button
              class="btn-sm danger"
              (click)="cancelRedemption(redemption)"
              title="Cancelar"
            >
              âœ• Cancelar
            </button>
            } @if (redemption.status === 'APPROVED') {
            <button
              class="btn-sm info"
              (click)="markAsDelivered(redemption)"
              title="Marcar como entregado"
            >
              ğŸ“¦ Entregar
            </button>
            }
            <button
              class="btn-sm"
              (click)="viewDetails(redemption)"
              title="Ver detalles"
            >
              ğŸ‘ï¸ Ver
            </button>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  @if (totalPages() > 1) {
  <div class="pagination">
    <button
      class="page-btn"
      [disabled]="currentPage() === 1"
      (click)="goToPage(currentPage() - 1)"
    >
      â† Anterior
    </button>

    <span class="page-info">
      PÃ¡gina {{ currentPage() }} de {{ totalPages() }}
      <span class="total-items">({{ totalItems() }} canjes)</span>
    </span>

    <button
      class="page-btn"
      [disabled]="currentPage() === totalPages()"
      (click)="goToPage(currentPage() + 1)"
    >
      Siguiente â†’
    </button>
  </div>
  } }

  <!-- Empty State -->
  @if (!isLoading() && redemptions().length === 0) {
  <div class="empty-state">
    <div class="empty-icon">ğŸŸï¸</div>
    <h3>No hay canjes</h3>
    <p>No se encontraron canjes con los filtros seleccionados</p>
  </div>
  }
</div>
